<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="mystic-hero">
        <h1><i class="bi bi-stars"></i> Nouveau Rêve</h1>
        <p>Décrivez votre rêve avec le plus de détails possible</p>
      </div>

      <div class="mystic-card position-relative" data-controller="loading">
        <%= form_with model: @dream, class: "mystic-form", data: { action: "submit->loading#start" } do |f| %>
          <div class="mb-3">
            <%= f.label :date, "Date du rêve", class: "form-label" %>
            <%= f.date_field :date, class: "form-control", data: { controller: "flatpickr", flatpickr_date_format_value: "d/m/Y", flatpickr_max_date_value: "today" } %>
            <% if @dream.errors[:date].any? %>
              <div class="text-danger mt-1"><%= @dream.errors[:date].first %></div>
            <% end %>
          </div>

          <div class="mb-4" data-controller="speech">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <%= f.label :content, "Décrivez votre rêve en détail", class: "form-label mb-0" %>
              <button type="button" class="btn btn-speech" data-speech-target="button" data-action="click->speech#toggle">
                <i class="bi bi-mic"></i> Dicter mon rêve
              </button>
            </div>
            <div class="speech-status" data-speech-target="status" style="display: none;"></div>
            <%= f.text_area :content, class: "form-control", placeholder: "Décrivez votre rêve avec le plus de détails possible. Incluez les lieux, les personnes, les actions, les émotions ressenties, les couleurs, les sons... Plus vous êtes détaillé, plus l'analyse sera précise.", rows: 10, data: { speech_target: "input" } %>
            <% if @dream.errors[:content].any? %>
              <div class="text-danger mt-1"><%= @dream.errors[:content].first %></div>
            <% end %>
            <small class="form-text text-muted mt-2">
              <i class="bi bi-lightbulb"></i> Le titre sera généré automatiquement par l'IA en fonction de votre rêve
            </small>
          </div>

          <div class="d-flex justify-content-between">
            <%= link_to "Annuler", dreams_path, class: "btn btn-mystic-secondary" %>
            <%= f.submit "Analyser mon rêve", class: "btn btn-mystic btn-lg", data: { loading_target: "button" } %>
          </div>
        <% end %>

        <!-- Overlay de chargement -->
        <div class="loading-overlay" data-loading-target="overlay" style="display: none;">
          <div class="loading-spinner-container" data-loading-target="spinner">
            <div class="mystic-spinner">
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
            </div>
            <p class="loading-text">
              <i class="bi bi-stars"></i><br>
              L'IA analyse votre rêve...<br>
              <small>Plongez dans les mystères de votre inconscient</small>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
